{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="card card-body">
    <input id="search-input" class="form-control" type="text">
</div>
            {% comment %} <legend> {% endcomment %}
                {% comment %} <div class="container"> {% endcomment %}
                    {% comment %} <h3>{{flexevent.pub_date}} </h3> {% endcomment %}
                    {% comment %} <a href="{% url 'kalender:rooster' %}">Rooster</a> {% endcomment %}
                  {% comment %} </div> {% endcomment %}
                {% comment %} <div> {% endcomment %}
                {% comment %} </div> {% endcomment %}
            {% comment %} </legend> {% endcomment %}
            {% comment %} <ul> {% endcomment %}
            {% comment %} </ul> {% endcomment %}
            <form action="{% url 'ploeg:assign' flexevent.id %}" method="post">
                {% csrf_token %}
                <input type="submit" value="Aanmelden/Afmelden">
                <div class="content-table"></div>
                <table class="content-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th> aanwezig op {{flexevent.pub_date}}</th>
                  {% comment %} <th>Naam</th> {% endcomment %}
                  <th></th>
                  <th>Bij / Af </th>
                </tr>
              </thead>
                    <tbody>
                        <td>{% for t in flexevent.lid.all %}
                            <tr>
                        </td>
                        <td> {{ forloop.counter }}</td>
                        <td>{{t.name }}</td>
                        <td>
                            <input type="checkbox" name="afmelding" id="host{{ forloop.counter }}" value="{{ t.id }}">
                        </td>
                        </td>

                        {% endfor %}
                        </tr>
                    </tbody>

                </table>
                <table class='content-table'>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Kandidaten</th>
                  {% comment %} <th>Selectie</th> {% endcomment %}
                  <th>Bij / Af </th>
                </tr>
              </thead>

                    <tbody id = myTable>
                        <td>{% for t in deelnemers %}
                            <tr>
                        </td>
                        <td>{{t.id }}</td>
                        <td>{{ forloop.counter }}. {{t.name}}</td>
                        <td>
                        <input type="checkbox" name="host" id="host{{ forloop.counter }}" value="{{ t.id }}">
                        </td>
                        </td>

                        {% endfor %}
                        </tr>
                    </tbody>

                </table>
            </form>
{% block javascript %}

<script>

{% comment %} var myArray=[]
$('th').on('click',function(){
    console.log('klik')
}) {% endcomment %}

$('#search-input').on('keyup',function(){
    var value = $(this).val()
    console.log('Value:', value)
     var data = searchTable(value,myArray)
     console.log(data)
    buildTable(data)
})

$.ajax({
    method:'GET',
    url:'http://127.0.0.1:8000/api/person/',
    success:function(response){
        myArray = response
        buildTable(myArray)
        // console.log(myArray)
    }
})

function searchTable(value, data){
    var filteredData =[]
    for (var i = 0; i < data.length; i++){
        value=value.toLowerCase()
        var name = data[i].name.toLowerCase()
        if (name.includes(value)){
            filteredData.push(data[i])
        }
    }
    return filteredData
}

function buildTable(data){
  
var table = document.getElementById('myTable')
table.innerHTML=``
for (var i = 0; i < data.length;i++){
      var row = `<tr> 
    <td> ${data[i].id} </td> 
    <td> ${data[i].name} </td> 
    <td> <label> <input type="checkbox" value="${data[i].id}" onchange="Check(this)" /> </label> <td id="mantis"> </td>
    </tr>`
  table.innerHTML += row
}
}

function Check(value) {
    console.log('Value:', value)
    // var testid = $(this).val(testid)
     console.log('Value:', value.parentelement)
      document.getElementById('mantis').innerHTML = value.checked;
      console.log('Value:', value.checked)
    };
  
</script>
{% endblock javascript %}              
{% endblock %}